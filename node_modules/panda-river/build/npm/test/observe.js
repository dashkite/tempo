"use strict";

var Amen, assert, next, observe, promise, value;
assert = require("assert");
Amen = require("amen");
({
  promise
} = require("panda-parchment"));
({
  next,
  value
} = require("../src/iterator"));
({
  observe
} = require("../src/observe"));
Amen.describe("Observe", function (context) {
  return context.test("change events", function* () {
    var proxy, reactor;
    ({
      proxy,
      reactor
    } = observe({
      value: 7
    }));
    setImmediate(function () {
      return proxy.value = 3;
    });
    assert.deepEqual({
      value: 3
    }, value((yield next(reactor))));

    (function (proxy, reactor) {
      return context.test("nested change events", function* () {
        ({
          proxy,
          reactor
        } = observe({
          value: {
            value: 7
          }
        }));
        setImmediate(function () {
          return proxy.value.value = 5;
        });
        return assert.deepEqual({
          value: {
            value: 5
          }
        }, value((yield next(reactor))));
      });
    })(proxy, reactor);

    return function (proxy, reactor) {
      return context.test("for arrays", function* () {
        ({
          proxy,
          reactor
        } = observe([1, 2, 3, 4, 5]));
        setImmediate(function () {
          return proxy.shift();
        });
        return assert.deepEqual([2, 3, 4, 5], value((yield next(reactor))));
      });
    }(proxy, reactor);
  });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9kYXZpZC9yZXBvcy9wYW5kYS1yaXZlci90ZXN0L29ic2VydmUuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsSUFBQSxJQUFBLEVBQUEsTUFBQSxFQUFBLElBQUEsRUFBQSxPQUFBLEVBQUEsT0FBQSxFQUFBLEtBQUE7QUFBQSxNQUFBLEdBQVMsT0FBQSxDQUFBLFFBQUEsQ0FBVDtBQUNBLElBQUEsR0FBTyxPQUFBLENBQUEsTUFBQSxDQUFQO0FBQ0EsQ0FBQTtBQUFBLEVBQUE7QUFBQSxJQUFZLE9BQUEsQ0FBWixpQkFBWSxDQUFaO0FBRUEsQ0FBQTtBQUFBLEVBQUEsSUFBQTtBQUFBLEVBQUE7QUFBQSxJQUFnQixPQUFBLENBQWhCLGlCQUFnQixDQUFoQjtBQUNBLENBQUE7QUFBQSxFQUFBO0FBQUEsSUFBWSxPQUFBLENBQVosZ0JBQVksQ0FBWjtBQUVBLElBQUksQ0FBSixRQUFBLENBQUEsU0FBQSxFQUF5QixVQUFBLE9BQUEsRUFBQTtTQUN2QixPQUFPLENBQVAsSUFBQSxDQUFBLGVBQUEsRUFBOEIsYUFBQTtBQUM1QixRQUFBLEtBQUEsRUFBQSxPQUFBO0FBQUEsS0FBQTtBQUFBLE1BQUEsS0FBQTtBQUFBLE1BQUE7QUFBQSxRQUFtQixPQUFBLENBQVE7QUFBQSxNQUFBLEtBQUEsRUFBTztBQUFQLEtBQVIsQ0FBbkI7QUFDQSxJQUFBLFlBQUEsQ0FBYSxZQUFBO2FBQUcsS0FBSyxDQUFMLEtBQUEsR0FBYyxDO0FBQTlCLEtBQUEsQ0FBQTtBQUNBLElBQUEsTUFBTSxDQUFOLFNBQUEsQ0FBaUI7QUFBQSxNQUFBLEtBQUEsRUFBTztBQUFQLEtBQWpCLEVBQ0UsS0FBQSxFQUFNLE1BQU0sSUFBQSxDQURkLE9BQ2MsQ0FBWixFQURGOztBQUdHLEtBQUEsVUFBQSxLQUFBLEVBQUEsT0FBQSxFQUFBO2FBQ0QsT0FBTyxDQUFQLElBQUEsQ0FBQSxzQkFBQSxFQUFxQyxhQUFBO0FBQ25DLFNBQUE7QUFBQSxVQUFBLEtBQUE7QUFBQSxVQUFBO0FBQUEsWUFBbUIsT0FBQSxDQUFRO0FBQUEsVUFBQSxLQUFBLEVBQU87QUFBQSxZQUFBLEtBQUEsRUFBTztBQUFQO0FBQVAsU0FBUixDQUFuQjtBQUNBLFFBQUEsWUFBQSxDQUFhLFlBQUE7aUJBQUcsS0FBSyxDQUFDLEtBQU4sQ0FBQSxLQUFBLEdBQW9CLEM7QUFBcEMsU0FBQSxDQUFBO2VBQ0EsTUFBTSxDQUFOLFNBQUEsQ0FBaUI7QUFBQSxVQUFBLEtBQUEsRUFBTztBQUFBLFlBQUEsS0FBQSxFQUFPO0FBQVA7QUFBUCxTQUFqQixFQUNFLEtBQUEsRUFBTSxNQUFNLElBQUEsQ0FEZCxPQUNjLENBQVosRUFERixDO0FBSEYsT0FBQSxDO0FBREYsS0FBRyxFQUFILEtBQUcsRUFBSCxPQUFHOztXQU9BLFVBQUEsS0FBQSxFQUFBLE9BQUEsRUFBQTthQUNELE9BQU8sQ0FBUCxJQUFBLENBQUEsWUFBQSxFQUEyQixhQUFBO0FBQ3pCLFNBQUE7QUFBQSxVQUFBLEtBQUE7QUFBQSxVQUFBO0FBQUEsWUFBbUIsT0FBQSxDQUFRLENBQUEsQ0FBQSxFQUFBLENBQUEsRUFBQSxDQUFBLEVBQUEsQ0FBQSxFQUEzQixDQUEyQixDQUFSLENBQW5CO0FBQ0EsUUFBQSxZQUFBLENBQWEsWUFBQTtpQkFBRyxLQUFLLENBQUwsS0FBQSxFO0FBQWhCLFNBQUEsQ0FBQTtlQUNBLE1BQU0sQ0FBTixTQUFBLENBQWlCLENBQUEsQ0FBQSxFQUFBLENBQUEsRUFBQSxDQUFBLEVBQWpCLENBQWlCLENBQWpCLEVBQ0UsS0FBQSxFQUFNLE1BQU0sSUFBQSxDQURkLE9BQ2MsQ0FBWixFQURGLEM7QUFIRixPQUFBLEM7QUFERixLQUFHLENBQUgsS0FBRyxFQUFILE9BQUcsQztBQWJMLEdBQUEsQztBQURGLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJhc3NlcnQgPSByZXF1aXJlIFwiYXNzZXJ0XCJcbkFtZW4gPSByZXF1aXJlIFwiYW1lblwiXG57cHJvbWlzZX0gPSByZXF1aXJlIFwicGFuZGEtcGFyY2htZW50XCJcblxue25leHQsIHZhbHVlfSA9IHJlcXVpcmUgXCIuLi9zcmMvaXRlcmF0b3JcIlxue29ic2VydmV9ID0gcmVxdWlyZSBcIi4uL3NyYy9vYnNlcnZlXCJcblxuQW1lbi5kZXNjcmliZSBcIk9ic2VydmVcIiwgKGNvbnRleHQpIC0+XG4gIGNvbnRleHQudGVzdCBcImNoYW5nZSBldmVudHNcIiwgLT5cbiAgICB7cHJveHksIHJlYWN0b3J9ID0gb2JzZXJ2ZSB2YWx1ZTogN1xuICAgIHNldEltbWVkaWF0ZSAtPiBwcm94eS52YWx1ZSA9IDNcbiAgICBhc3NlcnQuZGVlcEVxdWFsIHZhbHVlOiAzLFxuICAgICAgdmFsdWUgeWllbGQgbmV4dCByZWFjdG9yXG5cbiAgICBkbyAocHJveHksIHJlYWN0b3IpIC0+XG4gICAgICBjb250ZXh0LnRlc3QgXCJuZXN0ZWQgY2hhbmdlIGV2ZW50c1wiLCAtPlxuICAgICAgICB7cHJveHksIHJlYWN0b3J9ID0gb2JzZXJ2ZSB2YWx1ZTogdmFsdWU6IDdcbiAgICAgICAgc2V0SW1tZWRpYXRlIC0+IHByb3h5LnZhbHVlLnZhbHVlID0gNVxuICAgICAgICBhc3NlcnQuZGVlcEVxdWFsIHZhbHVlOiB2YWx1ZTogNSxcbiAgICAgICAgICB2YWx1ZSB5aWVsZCBuZXh0IHJlYWN0b3JcblxuICAgIGRvIChwcm94eSwgcmVhY3RvcikgLT5cbiAgICAgIGNvbnRleHQudGVzdCBcImZvciBhcnJheXNcIiwgLT5cbiAgICAgICAge3Byb3h5LCByZWFjdG9yfSA9IG9ic2VydmUgWzEuLjVdXG4gICAgICAgIHNldEltbWVkaWF0ZSAtPiBwcm94eS5zaGlmdCgpXG4gICAgICAgIGFzc2VydC5kZWVwRXF1YWwgWzIuLjVdLFxuICAgICAgICAgIHZhbHVlIHlpZWxkIG5leHQgcmVhY3RvclxuIl0sInNvdXJjZVJvb3QiOiIifQ==
//# sourceURL=/Users/david/repos/panda-river/test/observe.coffee