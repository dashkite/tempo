"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.pool = exports.wait = exports.into = exports.go = exports.flow = exports.union = exports.read = exports.events = exports.repeat = exports.producer = exports.isProducer = void 0;

var _pandaGenerics = _interopRequireDefault(require("panda-generics"));

var _pandaGarden = require("panda-garden");

var _pandaParchment = require("panda-parchment");

var _iterator = require("./iterator");

var _reactor = require("./reactor");

var _reducers = require("./reducers");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var create, define, events, flow, go, into, isFunctionList, isProducer, pool, producer, queue, read, repeat, union, wait;
exports.wait = wait;
exports.union = union;
exports.repeat = repeat;
exports.read = read;
exports.producer = producer;
exports.pool = pool;
exports.isProducer = isProducer;
exports.into = into;
exports.go = go;
exports.flow = flow;
exports.events = events;
({
  create,
  define
} = _pandaGenerics.default); // isProducer

exports.isProducer = isProducer = function (x) {
  return (0, _iterator.isIterator)(x) || (0, _reactor.isReactor)(x);
}; // producer


exports.producer = producer = create({
  name: "producer",
  description: "Attempts to turn its argument into an iterator or reactor."
});
define(producer, _iterator.isIterable, function (x) {
  return (0, _iterator.iterator)(x);
});
define(producer, _reactor.isReagent, function (x) {
  return (0, _reactor.reactor)(x);
});
define(producer, isProducer, _pandaGarden.identity); // repeat

exports.repeat = repeat = function* (x) {
  while (true) {
    yield x;
  }
}; // queue


queue = function () {
  var dq, p, q;
  q = [];
  p = [];
  return {
    enqueue: function (value) {
      var resolve;

      if (p.length > 0) {
        resolve = p.shift();
        return resolve(value);
      } else {
        return q.push(value);
      }
    },
    dequeue: dq = function () {
      if (q.length > 0) {
        return (0, _pandaParchment.follow)(q.shift());
      } else {
        return (0, _pandaParchment.promise)(function (resolve) {
          return p.push(resolve);
        });
      }
    },
    idle: function () {
      return p.length === 0 && q.length === 0;
    }
  };
}; // events


exports.events = events = (0, _pandaGarden.curry)(async function* (name, source) {
  var q, results;
  q = queue();

  if (source.on != null) {
    source.on(name, function (event) {
      return q.enqueue(event);
    });
  } else if (source.addEventListener != null) {
    source.addEventListener(name, function (event) {
      return q.enqueue(event);
    });
  } else {
    throw new TypeError("events: source must support `on` or `addEventListener` method");
  }

  results = [];

  while (true) {
    results.push((yield await q.dequeue()));
  }

  return results;
}); // read

exports.read = read = async function* (s) {
  var data, end, q, results;
  q = queue();
  end = false;
  s.on("data", function (data) {
    return q.enqueue(data);
  });
  s.on("error", function (error) {
    return q.enqueue((0, _pandaParchment.reject)(error));
  });
  s.on("end", function () {
    end = true;
    return q.enqueue(void 0);
  });
  results = [];

  while (true) {
    data = await q.dequeue();

    if (end) {
      break;
    } else {
      results.push((yield data));
    }
  }

  return results;
}; // union


exports.union = union = async function* (...px) {
  var done, i, len, p, q, results;
  q = queue();
  done = 0;

  for (i = 0, len = px.length; i < len; i++) {
    p = px[i];

    (async function (p) {
      var x;

      for await (x of p) {
        q.enqueue(x);
      }

      return done++;
    })(p);
  }

  while (true) {
    yield await q.dequeue();

    if (done === px.length) {
      break;
    }
  }

  results = [];

  while (!q.idle()) {
    results.push((yield await q.dequeue()));
  }

  return results;
}; // flow


isFunctionList = function (...fx) {
  var f, i, len;

  for (i = 0, len = fx.length; i < len; i++) {
    f = fx[i];

    if (!(0, _pandaParchment.isFunction)(f)) {
      return false;
    }
  }

  return true;
};

exports.flow = flow = create({
  name: "flow",
  description: "Compose functions and a producer."
}); // check for promise

define(flow, _pandaParchment.isDefined, _pandaParchment.isArray, function (x, ax) {
  return flow(x, ...ax);
});
define(flow, _pandaParchment.isDefined, isFunctionList, function (x, ...fx) {
  return flow(x, (0, _pandaGarden.pipe)(...fx));
});
define(flow, _pandaParchment.isDefined, _pandaParchment.isFunction, function (x, f) {
  return flow(producer(x), f);
});
define(flow, _pandaParchment.isPromise, _pandaParchment.isFunction, async function (x, f) {
  return flow((await x), f);
});
define(flow, isProducer, _pandaParchment.isFunction, function (p, f) {
  return f(p);
});
define(flow, _pandaParchment.isArray, function (ax) {
  return flow(...ax);
});
exports.go = go = (0, _pandaGarden.compose)(_reducers.start, flow);
exports.into = into = (0, _pandaGarden.curry)((0, _pandaGarden.binary)((0, _pandaGarden.flip)(go)));
exports.wait = wait = (0, _pandaGarden.curry)(async function* (filter, producer) {
  var ref, results, x;
  ref = filter(producer);
  results = [];

  for await (x of ref) {
    results.push((yield await x));
  }

  return results;
});
exports.pool = pool = (0, _pandaGarden.curry)(async function* (filter, producer) {
  var i, len, ref, results, x;
  ref = await (0, _pandaParchment.all)((0, _reducers.collect)(filter(producer)));
  results = [];

  for (i = 0, len = ref.length; i < len; i++) {
    x = ref[i];
    results.push((yield x));
  }

  return results;
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9kYXZpZC9yZXBvcy9wYW5kYS1yaXZlci9zcmMvYWRhcHRlcnMuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFHQTs7QUFDQTs7QUFDQTs7OztBQVBBLElBQUEsTUFBQSxFQUFBLE1BQUEsRUFBQSxNQUFBLEVBQUEsSUFBQSxFQUFBLEVBQUEsRUFBQSxJQUFBLEVBQUEsY0FBQSxFQUFBLFVBQUEsRUFBQSxJQUFBLEVBQUEsUUFBQSxFQUFBLEtBQUEsRUFBQSxJQUFBLEVBQUEsTUFBQSxFQUFBLEtBQUEsRUFBQSxJQUFBOzs7Ozs7Ozs7Ozs7QUFTQSxDQUFBO0FBQUEsRUFBQSxNQUFBO0FBQUEsRUFBQTtBQUFBLElBVEEsc0JBU0EsRTs7QUFJQSxxQkFBQSxVQUFBLEdBQWEsVUFBQSxDQUFBLEVBQUE7U0FBUSwwQkFBRCxDQUFDLENBQUQsSUFBbUIsd0JBQUQsQ0FBQyxDO0FBYnZDLENBYUEsQzs7O0FBSUEsbUJBQUEsUUFBQSxHQUFXLE1BQUEsQ0FDVDtBQUFBLEVBQUEsSUFBQSxFQUFBLFVBQUE7QUFDQSxFQUFBLFdBQUEsRUFBYTtBQURiLENBRFMsQ0FBWDtBQUlBLE1BQUEsQ0FBQSxRQUFBLEVBQUEsb0JBQUEsRUFBNkIsVUFBQSxDQUFBLEVBQUE7U0FBTyx3QkFBQSxDQUFBLEM7QUFBcEMsQ0FBQSxDQUFBO0FBQ0EsTUFBQSxDQUFBLFFBQUEsRUFBQSxrQkFBQSxFQUE0QixVQUFBLENBQUEsRUFBQTtTQUFPLHNCQUFBLENBQUEsQztBQUFuQyxDQUFBLENBQUE7QUFDQSxNQUFBLENBQUEsUUFBQSxFQUFBLFVBQUEsRUF2QkEscUJBdUJBLENBQUEsQzs7QUFJQSxpQkFBQSxNQUFBLEdBQVMsV0FBQSxDQUFBLEVBQUE7QUFBTyxTQUFBLElBQUEsRUFBQTtBQUFLLFVBQU0sQ0FBTjtBQUFMO0FBM0JoQixDQTJCQSxDOzs7QUFJQSxLQUFBLEdBQVEsWUFBQTtBQUNOLE1BQUEsRUFBQSxF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LENBQVA7QUFFQSxlQUFBLElBQUEsR0FBTyx3QkFBTSxpQkFBQSxNQUFBLEVBQUEsUUFBQSxFQUFBO0FBQ1gsTUFBQSxHQUFBLEVBQUEsT0FBQSxFQUFBLENBQUE7QUFBYyxFQUFBLEdBQUEsR0FBQSxNQUFBLENBQUEsUUFBQSxDQUFBO0FBQUEsRUFBQSxPQUFBLEdBQUEsRUFBQTs7QUFBQSxhQUFBLENBQUEsSUFBQSxHQUFBLEVBQUE7WUFBZCxJLEVBQUEsTUFBTSxNQUFOLEM7QUFBYzs7O0FBRFQsQ0FBQSxDQUFQO0FBR0EsZUFBQSxJQUFBLEdBQU8sd0JBQU0saUJBQUEsTUFBQSxFQUFBLFFBQUEsRUFBQTtBQUNYLE1BQUEsQ0FBQSxFQUFBLEdBQUEsRUFBQSxHQUFBLEVBQUEsT0FBQSxFQUFBLENBQUE7QUFBUSxFQUFBLEdBQUEsR0FBQSxNQUFBLHlCQUFBLHVCQUFBLE1BQUEsQ0FBQSxRQUFBLENBQUEsQ0FBQSxDQUFBO0FBQUEsRUFBQSxPQUFBLEdBQUEsRUFBQTs7QUFBQSxPQUFBLENBQUEsR0FBQSxDQUFBLEVBQUEsR0FBQSxHQUFBLEdBQUEsQ0FBQSxNQUFBLEVBQUEsQ0FBQSxHQUFBLEdBQUEsRUFBQSxDQUFBLEVBQUEsRUFBQTs7WUFBUixJLEVBQUEsTUFBQSxDO0FBQVE7OztBQURILENBQUEsQ0FBUCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBNZXRob2QgZnJvbSBcInBhbmRhLWdlbmVyaWNzXCJcbmltcG9ydCB7aWRlbnRpdHksIGN1cnJ5LCBiaW5hcnksIGNvbXBvc2UsIHBpcGUsIGZsaXB9IGZyb20gXCJwYW5kYS1nYXJkZW5cIlxuaW1wb3J0IHtwcm9taXNlLCBmb2xsb3csIHJlamVjdCwgYWxsLFxuICBpc0RlZmluZWQsIGlzQXJyYXksIGlzRnVuY3Rpb24sIGlzUHJvbWlzZX0gZnJvbSBcInBhbmRhLXBhcmNobWVudFwiXG5cbmltcG9ydCB7aXNJdGVyYWJsZSwgaXNJdGVyYXRvciwgaXRlcmF0b3J9IGZyb20gXCIuL2l0ZXJhdG9yXCJcbmltcG9ydCB7aXNSZWFnZW50LCBpc1JlYWN0b3IsIHJlYWN0b3J9IGZyb20gXCIuL3JlYWN0b3JcIlxuaW1wb3J0IHtzdGFydCwgY29sbGVjdH0gZnJvbSBcIi4vcmVkdWNlcnNcIlxuXG57Y3JlYXRlLCBkZWZpbmV9ID0gTWV0aG9kXG5cbiMgaXNQcm9kdWNlclxuXG5pc1Byb2R1Y2VyID0gKHgpIC0+IChpc0l0ZXJhdG9yIHgpIHx8IChpc1JlYWN0b3IgeClcblxuIyBwcm9kdWNlclxuXG5wcm9kdWNlciA9IGNyZWF0ZVxuICBuYW1lOiBcInByb2R1Y2VyXCJcbiAgZGVzY3JpcHRpb246IFwiQXR0ZW1wdHMgdG8gdHVybiBpdHMgYXJndW1lbnQgaW50byBhbiBpdGVyYXRvciBvciByZWFjdG9yLlwiXG5cbmRlZmluZSBwcm9kdWNlciwgaXNJdGVyYWJsZSwgKHgpIC0+IGl0ZXJhdG9yIHhcbmRlZmluZSBwcm9kdWNlciwgaXNSZWFnZW50LCAoeCkgLT4gcmVhY3RvciB4XG5kZWZpbmUgcHJvZHVjZXIsIGlzUHJvZHVjZXIsIGlkZW50aXR5XG5cbiMgcmVwZWF0XG5cbnJlcGVhdCA9ICh4KSAtPiBsb29wIHlpZWxkIHggOyByZXR1cm5cblxuIyBxdWV1ZVxuXG5xdWV1ZSA9IC0+XG4gIHEgPSBbXVxuICBwID0gW11cbiAgZW5xdWV1ZTogKHZhbHVlKSAtPlxuICAgIGlmIHAubGVuZ3RoID4gMFxuICAgICAgcmVzb2x2ZSA9IHAuc2hpZnQoKVxuICAgICAgcmVzb2x2ZSB2YWx1ZVxuICAgIGVsc2VcbiAgICAgIHEucHVzaCB2YWx1ZVxuICBkZXF1ZXVlOiBkcSA9IC0+XG4gICAgaWYgcS5sZW5ndGggPiAwXG4gICAgICBmb2xsb3cgcS5zaGlmdCgpXG4gICAgZWxzZVxuICAgICAgcHJvbWlzZSAocmVzb2x2ZSkgLT4gcC5wdXNoIHJlc29sdmVcbiAgaWRsZTogLT4gcC5sZW5ndGggPT0gMCAmJiBxLmxlbmd0aCA9PSAwXG5cbiMgZXZlbnRzXG5cbmV2ZW50cyA9IGN1cnJ5IChuYW1lLCBzb3VyY2UpIC0+XG4gIHEgPSBxdWV1ZSgpXG4gIGlmIHNvdXJjZS5vbj9cbiAgICBzb3VyY2Uub24gbmFtZSwgKGV2ZW50KSAtPiBxLmVucXVldWUgZXZlbnRcbiAgZWxzZSBpZiBzb3VyY2UuYWRkRXZlbnRMaXN0ZW5lcj9cbiAgICBzb3VyY2UuYWRkRXZlbnRMaXN0ZW5lciBuYW1lLCAoZXZlbnQpIC0+IHEuZW5xdWV1ZSBldmVudFxuICBlbHNlIHRocm93IG5ldyBUeXBlRXJyb3IgXCJldmVudHM6IHNvdXJjZSBtdXN0IHN1cHBvcnRcbiAgICBgb25gIG9yIGBhZGRFdmVudExpc3RlbmVyYCBtZXRob2RcIlxuICBsb29wIHlpZWxkIGF3YWl0IHEuZGVxdWV1ZSgpXG5cbiMgcmVhZFxuXG5yZWFkID0gKHMpIC0+XG4gIHEgPSBxdWV1ZSgpXG4gIGVuZCA9IGZhbHNlXG4gIHMub24gXCJkYXRhXCIsIChkYXRhKSAtPiBxLmVucXVldWUgZGF0YVxuICBzLm9uIFwiZXJyb3JcIiwgKGVycm9yKSAtPiBxLmVucXVldWUgcmVqZWN0IGVycm9yXG4gIHMub24gXCJlbmRcIiwgLT5cbiAgICBlbmQgPSB0cnVlXG4gICAgcS5lbnF1ZXVlIHVuZGVmaW5lZFxuXG4gIGxvb3BcbiAgICBkYXRhID0gYXdhaXQgcS5kZXF1ZXVlKClcbiAgICBpZiBlbmQgdGhlbiBicmVhayBlbHNlIHlpZWxkIGRhdGFcblxuIyB1bmlvblxuXG51bmlvbiA9IChweC4uLikgLT5cbiAgcSA9IHF1ZXVlKClcbiAgZG9uZSA9IDBcbiAgZm9yIHAgaW4gcHhcbiAgICBkbyAocCkgLT5cbiAgICAgIHEuZW5xdWV1ZSB4IGZvciBhd2FpdCB4IGZyb20gcFxuICAgICAgZG9uZSsrXG4gIGxvb3BcbiAgICB5aWVsZCBhd2FpdCBxLmRlcXVldWUoKVxuICAgIGJyZWFrIGlmIGRvbmUgPT0gcHgubGVuZ3RoXG4gIHlpZWxkIGF3YWl0IHEuZGVxdWV1ZSgpIHVudGlsIHEuaWRsZSgpXG5cbiMgZmxvd1xuXG5pc0Z1bmN0aW9uTGlzdCA9IChmeC4uLikgLT5cbiAgcmV0dXJuIGZhbHNlIGZvciBmIGluIGZ4IHdoZW4gIWlzRnVuY3Rpb24gZlxuICB0cnVlXG5cbmZsb3cgPSBjcmVhdGVcbiAgbmFtZTogXCJmbG93XCJcbiAgZGVzY3JpcHRpb246IFwiQ29tcG9zZSBmdW5jdGlvbnMgYW5kIGEgcHJvZHVjZXIuXCJcblxuIyBjaGVjayBmb3IgcHJvbWlzZVxuXG5kZWZpbmUgZmxvdywgaXNEZWZpbmVkLCBpc0FycmF5LCAoeCwgYXgpIC0+IGZsb3cgeCwgYXguLi5cbmRlZmluZSBmbG93LCBpc0RlZmluZWQsIGlzRnVuY3Rpb25MaXN0LCAoeCwgZnguLi4pIC0+IGZsb3cgeCwgcGlwZSBmeC4uLlxuZGVmaW5lIGZsb3csIGlzRGVmaW5lZCwgaXNGdW5jdGlvbiwgKHgsIGYpIC0+IGZsb3cgKHByb2R1Y2VyIHgpLCBmXG5kZWZpbmUgZmxvdywgaXNQcm9taXNlLCBpc0Z1bmN0aW9uLCAoeCwgZikgLT4gZmxvdyAoYXdhaXQgeCksIGZcbmRlZmluZSBmbG93LCBpc1Byb2R1Y2VyLCBpc0Z1bmN0aW9uLCAocCwgZikgLT4gZiBwXG5kZWZpbmUgZmxvdywgaXNBcnJheSwgKGF4KSAtPiBmbG93IGF4Li4uXG5cbmdvID0gY29tcG9zZSBzdGFydCwgZmxvd1xuXG5pbnRvID0gY3VycnkgYmluYXJ5IGZsaXAgZ29cblxud2FpdCA9IGN1cnJ5IChmaWx0ZXIsIHByb2R1Y2VyKSAtPlxuICB5aWVsZCBhd2FpdCB4IGZvciBhd2FpdCB4IGZyb20gZmlsdGVyIHByb2R1Y2VyXG5cbnBvb2wgPSBjdXJyeSAoZmlsdGVyLCBwcm9kdWNlcikgLT5cbiAgeWllbGQgeCBmb3IgeCBpbiBhd2FpdCBhbGwgY29sbGVjdCBmaWx0ZXIgcHJvZHVjZXJcblxuZXhwb3J0IHtpc1Byb2R1Y2VyLCBwcm9kdWNlciwgcmVwZWF0LFxuICBldmVudHMsIHJlYWQsIHVuaW9uLFxuICBmbG93LCBnbywgaW50bywgd2FpdCwgcG9vbH1cbiJdLCJzb3VyY2VSb290IjoiIn0=
//# sourceURL=/Users/david/repos/panda-river/src/adapters.coffee