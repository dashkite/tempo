"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.shell = void 0;

var _child_process = require("child_process");

var _path = require("path");

var _pandaParchment = require("panda-parchment");

// Helpers to run external programs
var log, print, shell;
exports.shell = shell;

print = function (_process) {
  return new Promise(function (resolve, reject) {
    _process.stdout.on("data", function (data) {
      return process.stdout.write(data.toString());
    });

    _process.stderr.on("data", function (data) {
      return process.stderr.write(data.toString());
    });

    _process.on("error", function (error) {
      console.error(error);
      return reject();
    });

    return _process.on("close", function (exitCode) {
      if (exitCode === 0) {
        return resolve();
      } else {
        console.error(`Exited with non-zero code, ${exitCode}`);
        return reject();
      }
    });
  });
};

exports.shell = shell = async function (str, path) {
  var args, command;
  [command, ...args] = (0, _pandaParchment.w)(str);

  if (path) {
    return await print((await (0, _child_process.spawn)(command, args, {
      cwd: (0, _path.resolve)(process.cwd(), path)
    })));
  } else {
    return await print((await (0, _child_process.spawn)(command, args, {
      cwd: (0, _path.resolve)(process.cwd())
    })));
  }
};

log = function (message) {
  return console.error(message);
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9kYXZpZC9yZXBvcy9wYW5kYS1idWlsZGVyL3NyYy9zaGVsbC5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUNBOztBQUNBOztBQUNBOztBQUhBO0FBQUEsSUFBQSxHQUFBLEVBQUEsS0FBQSxFQUFBLEtBQUE7OztBQUtBLEtBQUEsR0FBUSxVQUFBLFFBQUEsRUFBQTtTQUNOLElBQUEsT0FBQSxDQUFZLFVBQUEsT0FBQSxFQUFBLE1BQUEsRUFBQTtBQUNWLElBQUEsUUFBUSxDQUFDLE1BQVQsQ0FBQSxFQUFBLENBQUEsTUFBQSxFQUEyQixVQUFBLElBQUEsRUFBQTthQUFVLE9BQU8sQ0FBQyxNQUFSLENBQUEsS0FBQSxDQUFxQixJQUFJLENBQXpCLFFBQXFCLEVBQXJCLEM7QUFBckMsS0FBQTs7QUFDQSxJQUFBLFFBQVEsQ0FBQyxNQUFULENBQUEsRUFBQSxDQUFBLE1BQUEsRUFBMkIsVUFBQSxJQUFBLEVBQUE7YUFBVSxPQUFPLENBQUMsTUFBUixDQUFBLEtBQUEsQ0FBcUIsSUFBSSxDQUF6QixRQUFxQixFQUFyQixDO0FBQXJDLEtBQUE7O0FBQ0EsSUFBQSxRQUFRLENBQVIsRUFBQSxDQUFBLE9BQUEsRUFBcUIsVUFBQSxLQUFBLEVBQUE7QUFDbkIsTUFBQSxPQUFPLENBQVAsS0FBQSxDQUFBLEtBQUE7YUFDQSxNQUFBLEU7QUFGRixLQUFBOztXQUdBLFFBQVEsQ0FBUixFQUFBLENBQUEsT0FBQSxFQUFxQixVQUFBLFFBQUEsRUFBQTtBQUNuQixVQUFHLFFBQUEsS0FBSCxDQUFBLEVBQUE7ZUFDRSxPQURGLEU7QUFBQSxPQUFBLE1BQUE7QUFHRSxRQUFBLE9BQU8sQ0FBUCxLQUFBLENBQWMsOEJBQUEsUUFBZCxFQUFBO2VBQ0EsTUFKRixFOztBQURGLEtBQUEsQztBQU5GLEdBQUEsQztBQURNLENBQVI7O0FBZUEsZ0JBQUEsS0FBQSxHQUFRLGdCQUFBLEdBQUEsRUFBQSxJQUFBLEVBQUE7QUFDTixNQUFBLElBQUEsRUFBQSxPQUFBO0FBQUEsR0FBQSxPQUFBLEVBQVUsR0FBVixJQUFBLElBQXFCLHVCQUFBLEdBQUEsQ0FBckI7O0FBQ0EsTUFBQSxJQUFBLEVBQUE7QUFDRSxXQUFBLE1BQU0sS0FBQSxFQUFNLE1BQU0sMEJBQUEsT0FBQSxFQUFBLElBQUEsRUFBcUI7QUFBQSxNQUFBLEdBQUEsRUFBSyxtQkFBWSxPQUFPLENBQW5CLEdBQVksRUFBWixFQUFBLElBQUE7QUFBTCxLQUFyQixDQUFaLEVBQU47QUFERixHQUFBLE1BQUE7QUFHRSxXQUFBLE1BQU0sS0FBQSxFQUFNLE1BQU0sMEJBQUEsT0FBQSxFQUFBLElBQUEsRUFBcUI7QUFBQSxNQUFBLEdBQUEsRUFBSyxtQkFBWSxPQUFPLENBQW5CLEdBQVksRUFBWjtBQUFMLEtBQXJCLENBQVosRUFBTjs7QUFMSSxDQUFSOztBQU9BLEdBQUEsR0FBTSxVQUFBLE9BQUEsRUFBQTtTQUFhLE9BQU8sQ0FBUCxLQUFBLENBQUEsT0FBQSxDO0FBQWIsQ0FBTiIsInNvdXJjZXNDb250ZW50IjpbIiMgSGVscGVycyB0byBydW4gZXh0ZXJuYWwgcHJvZ3JhbXNcbmltcG9ydCB7c3Bhd259IGZyb20gXCJjaGlsZF9wcm9jZXNzXCJcbmltcG9ydCB7cmVzb2x2ZSBhcyByZXNvbHZlUGF0aH0gZnJvbSBcInBhdGhcIlxuaW1wb3J0IHt3fSBmcm9tIFwicGFuZGEtcGFyY2htZW50XCJcblxucHJpbnQgPSAoX3Byb2Nlc3MpIC0+XG4gIG5ldyBQcm9taXNlIChyZXNvbHZlLCByZWplY3QpIC0+XG4gICAgX3Byb2Nlc3Muc3Rkb3V0Lm9uIFwiZGF0YVwiLCAoZGF0YSkgLT4gcHJvY2Vzcy5zdGRvdXQud3JpdGUgZGF0YS50b1N0cmluZygpXG4gICAgX3Byb2Nlc3Muc3RkZXJyLm9uIFwiZGF0YVwiLCAoZGF0YSkgLT4gcHJvY2Vzcy5zdGRlcnIud3JpdGUgZGF0YS50b1N0cmluZygpXG4gICAgX3Byb2Nlc3Mub24gXCJlcnJvclwiLCAoZXJyb3IpIC0+XG4gICAgICBjb25zb2xlLmVycm9yIGVycm9yXG4gICAgICByZWplY3QoKVxuICAgIF9wcm9jZXNzLm9uIFwiY2xvc2VcIiwgKGV4aXRDb2RlKSAtPlxuICAgICAgaWYgZXhpdENvZGUgPT0gMFxuICAgICAgICByZXNvbHZlKClcbiAgICAgIGVsc2VcbiAgICAgICAgY29uc29sZS5lcnJvciBcIkV4aXRlZCB3aXRoIG5vbi16ZXJvIGNvZGUsICN7ZXhpdENvZGV9XCJcbiAgICAgICAgcmVqZWN0KClcblxuXG5zaGVsbCA9IChzdHIsIHBhdGgpIC0+XG4gIFtjb21tYW5kLCBhcmdzLi4uXSA9IHcgc3RyXG4gIGlmIHBhdGhcbiAgICBhd2FpdCBwcmludCBhd2FpdCBzcGF3biBjb21tYW5kLCBhcmdzLCBjd2Q6IHJlc29sdmVQYXRoIHByb2Nlc3MuY3dkKCksIHBhdGhcbiAgZWxzZVxuICAgIGF3YWl0IHByaW50IGF3YWl0IHNwYXduIGNvbW1hbmQsIGFyZ3MsIGN3ZDogcmVzb2x2ZVBhdGggcHJvY2Vzcy5jd2QoKVxuXG5sb2cgPSAobWVzc2FnZSkgLT4gY29uc29sZS5lcnJvciBtZXNzYWdlXG5cblxuZXhwb3J0IHtzaGVsbH1cbiJdLCJzb3VyY2VSb290IjoiIn0=
//# sourceURL=/Users/david/repos/panda-builder/src/shell.coffee