"use strict";

var all, any, between, escape, forward, grammar, join, list, many, match, merge, optional, re, rule, string, tag, word, ws;

match = function (re, s) {
  return s.match(re);
};

escape = function (s) {
  return s.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
};

re = function (re) {
  return function (s) {
    var $m, rest, value;

    if (($m = match(re, s)) != null) {
      [value] = $m;
      rest = s.slice($m.index + value.length);
      return {
        value,
        rest
      };
    }
  };
};

word = re(/^\w+/);
ws = re(/^\s+/);

string = function (s) {
  return re(RegExp(`^${escape(s)}`));
};

any = function (...px) {
  return function (s) {
    var $m, i, len, p;

    for (i = 0, len = px.length; i < len; i++) {
      p = px[i];
      $m = p(s);

      if ($m != null) {
        return $m;
      }
    }

    return null;
  };
};

optional = function (p) {
  return any(p, function (s) {
    return {
      rest: s
    };
  });
};

all = function (...px) {
  return function (s) {
    var $m, i, len, p, rest, value, values;
    values = [];

    for (i = 0, len = px.length; i < len; i++) {
      p = px[i];
      $m = p(s);

      if ($m == null) {
        return null;
      }

      ({
        value,
        rest
      } = $m);
      s = rest;
      values.push(value);
    }

    return {
      value: values,
      rest: s
    };
  };
};

many = function (p) {
  return function (s) {
    var $m, r;
    r = [];

    while (s.length > 0 && ($m = p(s)) != null) {
      r.push($m.value);
      s = $m.rest;
    }

    if (r.length > 0) {
      return {
        value: r,
        rest: s
      };
    }
  };
};

list = function (d, p) {
  return function (rest) {
    var $m, _value, value;

    _value = [];

    while (rest.length > 0) {
      if (($m = p(rest)) != null) {
        ({
          value,
          rest
        } = $m);

        _value.push(value);

        if (($m = d(rest)) != null) {
          ({
            rest
          } = $m);
        } else {
          return {
            value: _value,
            rest
          };
        }
      } else {
        return null;
      }
    }
  };
};

between = function (open, close, p) {
  return rule(all(open, p, close), function ({
    value: [, v]
  }) {
    return v;
  });
};

forward = function (fn) {
  return function (s) {
    return fn()(s);
  };
};

rule = function (p, a) {
  return function (s) {
    var $m;
    $m = p(s);

    if ($m != null) {
      return {
        value: a($m),
        rest: $m.rest
      };
    }
  };
};

tag = function (name, p) {
  return rule(p, function ({
    value
  }) {
    return {
      [name]: value
    };
  });
};

merge = function (p) {
  return rule(p, function ({
    value
  }) {
    return Object.assign({}, ...value);
  });
};

join = function (p) {
  return rule(p, function ({
    value
  }) {
    return value.join("");
  });
};

grammar = function (r) {
  return function (s) {
    var $m, rest, value;
    $m = r(s);

    if ($m != null) {
      ({
        value,
        rest
      } = $m);

      if (rest === "") {
        return value;
      }
    }
  };
};

module.exports = {
  re,
  string,
  word,
  ws,
  any,
  optional,
  forward,
  all,
  many,
  list,
  between,
  rule,
  tag,
  merge,
  join,
  grammar
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9kYXZpZC9yZXBvcy9wYW5kYS1ncmFtbWFyL3NyYy9pbmRleC5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFBLEdBQUEsRUFBQSxHQUFBLEVBQUEsT0FBQSxFQUFBLE1BQUEsRUFBQSxPQUFBLEVBQUEsT0FBQSxFQUFBLElBQUEsRUFBQSxJQUFBLEVBQUEsSUFBQSxFQUFBLEtBQUEsRUFBQSxLQUFBLEVBQUEsUUFBQSxFQUFBLEVBQUEsRUFBQSxJQUFBLEVBQUEsTUFBQSxFQUFBLEdBQUEsRUFBQSxJQUFBLEVBQUEsRUFBQTs7QUFBQSxLQUFBLEdBQVEsVUFBQSxFQUFBLEVBQUEsQ0FBQSxFQUFBO1NBQVcsQ0FBQyxDQUFELEtBQUEsQ0FBQSxFQUFBLEM7QUFBWCxDQUFSOztBQUVBLE1BQUEsR0FBUyxVQUFBLENBQUEsRUFBQTtTQUFPLENBQUMsQ0FBRCxPQUFBLENBQUEscUJBQUEsRUFBQSxNQUFBLEM7QUFBUCxDQUFUOztBQUVBLEVBQUEsR0FBSyxVQUFBLEVBQUEsRUFBQTtTQUNILFVBQUEsQ0FBQSxFQUFBO0FBQ0UsUUFBQSxFQUFBLEVBQUEsSUFBQSxFQUFBLEtBQUE7O0FBQUEsUUFBRyxDQUFBLEVBQUEsR0FBQSxLQUFBLENBQUEsRUFBQSxFQUFBLENBQUEsQ0FBQSxLQUFILElBQUEsRUFBQTtBQUNFLE9BQUEsS0FBQSxJQUFVLEVBQVY7QUFDQSxNQUFBLElBQUEsR0FBTyxDQUFFLENBQUEsS0FBRixDQUFFLEVBQUEsQ0FBQSxLQUFBLEdBQUEsS0FBQSxDQUFBLE1BQUYsQ0FBUDthQUNBO0FBQUEsUUFBQSxLQUFBO0FBSEYsUUFBQTtBQUdFLE87O0FBSkosRztBQURHLENBQUw7O0FBT0EsSUFBQSxHQUFPLEVBQUEsQ0FBQSxNQUFBLENBQVA7QUFFQSxFQUFBLEdBQUssRUFBQSxDQUFBLE1BQUEsQ0FBTDs7QUFFQSxNQUFBLEdBQVMsVUFBQSxDQUFBLEVBQUE7U0FBTyxFQUFBLENBQUcsTUFBQSxDQUFBLElB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VUFBQztBQUFELElBQUE7QUFBQyxHQUFELEVBQUE7V0FBYSxNQUFNLENBQU4sTUFBQSxDQUFBLEVBQUEsRUFBa0IsR0FBbEIsS0FBQSxDO0FBQXJCLEdBQUEsQztBQUFQLENBQVI7O0FBRUEsSUFBQSxHQUFPLFVBQUEsQ0FBQSxFQUFBO1NBQU8sSUFBQSxDQUFBLENBQUEsRUFBUSxVQUFDO0FBQUQsSUFBQTtBQUFDLEdBQUQsRUFBQTtXQUFhLEtBQUssQ0FBTCxJQUFBLENBQUEsRUFBQSxDO0FBQXJCLEdBQUEsQztBQUFQLENBQVA7O0FBRUEsT0FBQSxHQUFVLFVBQUEsQ0FBQSxFQUFBO1NBQ1IsVUFBQSxDQUFBLEVBQUE7QUFDRSxRQUFBLEVBQUEsRUFBQSxJQUFBLEVBQUEsS0FBQTtBQUFBLElBQUEsRUFBQSxHQUFLLENBQUEsQ0FBQSxDQUFBLENBQUw7O0FBQ0EsUUFBRyxFQUFBLElBQUgsSUFBQSxFQUFBO0FBQ0UsT0FBQTtBQUFBLFFBQUEsS0FBQTtBQUFBLFFBQUE7QUFBQSxVQUFBLEVBQUE7O0FBQ0EsVUFBRyxJQUFBLEtBQUgsRUFBQSxFQUFBO2VBQUEsSztBQUZGOztBQUZGLEc7QUFEUSxDQUFWOztBQVFBLE1BQU0sQ0FBTixPQUFBLEdBQWlCO0FBQUEsRUFBQSxFQUFBO0FBQUEsRUFBQSxNQUFBO0FBQUEsRUFBQSxJQUFBO0FBQUEsRUFBQSxFQUFBO0FBQUEsRUFBQSxHQUFBO0FBQUEsRUFBQSxRQUFBO0FBQUEsRUFBQSxPQUFBO0FBQUEsRUFBQSxHQUFBO0FBQUEsRUFBQSxJQUFBO0FBQUEsRUFBQSxJQUFBO0FBQUEsRUFBQSxPQUFBO0FBQUEsRUFBQSxJQUFBO0FBQUEsRUFBQSxHQUFBO0FBQUEsRUFBQSxLQUFBO0FBQUEsRUFBQSxJQUFBO0FBQUEsRUFBQTtBQUFBLENBQWpCIiwic291cmNlc0NvbnRlbnQiOlsibWF0Y2ggPSAocmUsIHMpIC0+IHMubWF0Y2ggcmVcblxuZXNjYXBlID0gKHMpIC0+IHMucmVwbGFjZSAvWy4qKz9eJHt9KCl8W1xcXVxcXFxdL2csIFwiXFxcXCQmXCJcblxucmUgPSAocmUpIC0+XG4gIChzKSAtPlxuICAgIGlmICgkbSA9IChtYXRjaCByZSwgcykpP1xuICAgICAgW3ZhbHVlXSA9ICRtXG4gICAgICByZXN0ID0gc1soJG0uaW5kZXggKyB2YWx1ZS5sZW5ndGgpLi5dXG4gICAgICB7dmFsdWUsIHJlc3R9XG5cbndvcmQgPSByZSAvXlxcdysvXG5cbndzID0gcmUgL15cXHMrL1xuXG5zdHJpbmcgPSAocykgLT4gcmUgLy8vXiN7ZXNjYXBlIHN9Ly8vXG5cbmFueSA9IChweC4uLikgLT5cbiAgKHMpIC0+XG4gICAgZm9yIHAgaW4gcHhcbiAgICAgICRtID0gcCBzXG4gICAgICByZXR1cm4gJG0gaWYgJG0/XG4gICAgcmV0dXJuIG51bGxcblxub3B0aW9uYWwgPSAocCkgLT4gYW55IHAsICgocykgLT4gcmVzdDogcylcblxuYWxsID0gKHB4Li4uKSAtPlxuICAocykgLT5cbiAgICB2YWx1ZXMgPSBbXVxuICAgIGZvciBwIGluIHB4XG4gICAgICAkbSA9IHAgc1xuICAgICAgcmV0dXJuIG51bGwgdW5sZXNzICRtP1xuICAgICAge3ZhbHVlLCByZXN0fSA9ICRtXG4gICAgICBzID0gcmVzdFxuICAgICAgdmFsdWVzLnB1c2ggdmFsdWVcbiAgICB7dmFsdWU6IHZhbHVlcywgcmVzdDogc31cblxubWFueSA9IChwKSAtPlxuICAocykgLT5cbiAgICByID0gW11cbiAgICB3aGlsZSAocy5sZW5ndGggPiAwKSAmJiAoJG0gPSBwIHMpP1xuICAgICAgci5wdXNoICRtLnZhbHVlXG4gICAgICBzID0gJG0ucmVzdFxuICAgIHt2YWx1ZTogciwgcmVzdDogc30gaWYgci5sZW5ndGggPiAwXG5cbmxpc3QgPSAoZCwgcCkgLT5cbiAgKHJlc3QpIC0+XG4gICAgX3ZhbHVlID0gW11cbiAgICB3aGlsZSByZXN0Lmxlbmd0aCA+IDBcbiAgICAgIGlmICgkbSA9IChwIHJlc3QpKT9cbiAgICAgICAge3ZhbHVlLCByZXN0fSA9ICRtXG4gICAgICAgIF92YWx1ZS5wdXNoIHZhbHVlXG4gICAgICAgIGlmICgkbSA9IGQgcmVzdCk/XG4gICAgICAgICAge3Jlc3R9ID0gJG1cbiAgICAgICAgZWxzZVxuICAgICAgICAgIHJldHVybiB7dmFsdWU6IF92YWx1ZSwgcmVzdH1cbiAgICAgIGVsc2VcbiAgICAgICAgcmV0dXJuIG51bGxcblxuYmV0d2VlbiA9IChvcGVuLCBjbG9zZSwgcCkgLT5cbiAgcnVsZSAoYWxsIG9wZW4sIHAsIGNsb3NlKSwgKHt2YWx1ZTogWyx2XX0pIC0+IHZcblxuZm9yd2FyZCA9IChmbikgLT4gKHMpIC0+IGZuKCkocylcblxucnVsZSA9IChwLCBhKSAtPlxuICAocykgLT5cbiAgICAkbSA9IHAgc1xuICAgIGlmICRtP1xuICAgICAge3ZhbHVlOiBhKCRtKSwgcmVzdDogJG0ucmVzdH1cblxudGFnID0gKG5hbWUsIHApIC0+IHJ1bGUgcCwgKHt2YWx1ZX0pIC0+IFtuYW1lXTogdmFsdWVcblxubWVyZ2UgPSAocCkgLT4gcnVsZSBwLCAoe3ZhbHVlfSkgLT4gT2JqZWN0LmFzc2lnbiB7fSwgdmFsdWUuLi5cblxuam9pbiA9IChwKSAtPiBydWxlIHAsICh7dmFsdWV9KSAtPiB2YWx1ZS5qb2luIFwiXCJcblxuZ3JhbW1hciA9IChyKSAtPlxuICAocykgLT5cbiAgICAkbSA9IHIocylcbiAgICBpZiAkbT9cbiAgICAgIHt2YWx1ZSwgcmVzdH0gPSAkbVxuICAgICAgaWYgcmVzdCA9PSBcIlwiXG4gICAgICAgIHZhbHVlXG5cbm1vZHVsZS5leHBvcnRzID0ge3JlLCBzdHJpbmcsIHdvcmQsIHdzLCBhbnksIG9wdGlvbmFsLCBmb3J3YXJkLFxuICBhbGwsIG1hbnksIGxpc3QsIGJldHdlZW4sXG4gIHJ1bGUsIHRhZywgbWVyZ2UsIGpvaW4sXG4gIGdyYW1tYXJ9XG4iXSwic291cmNlUm9vdCI6IiJ9
//# sourceURL=/Users/david/repos/panda-grammar/src/index.coffee